---

---

<div class="fixed right-6 bottom-6 z-50">
  <div
    id="help-popover"
    class="absolute right-0 bottom-full mb-3 hidden w-72 rounded-lg bg-white p-6 opacity-0 shadow-xl ring-1 ring-gray-200 transition-all duration-400 ease-out"
    role="tooltip"
    aria-hidden="true"
  >
    <div class="absolute right-6 -bottom-1 h-2 w-2 rotate-45 bg-white ring-1 ring-gray-200"></div>

    <div class="space-y-4">
      <div>
        <h3 class="text-sm/6 font-medium text-gray-950">Besoin d'aide ?</h3>
        <p class="mt-0.5 text-sm/5 text-gray-600">
          Hexium vous aide à trouver la solution qui vous convient le mieux.
        </p>
      </div>

      <ul class="grid space-y-3">
        <li>
          <a
            class="relative flex items-center gap-x-3 text-sm/6 font-medium text-gray-950"
            href="/realisations"
          >
            <svg
              data-slot="icon"
              fill="none"
              stroke-width="1.5"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
              class="size-5"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"
              ></path>
            </svg>
            Nos réalisations</a
          >
        </li>
        <li>
          <a
            class="relative flex items-center gap-x-3 text-sm/6 font-medium text-gray-950"
            href="/contact"
          >
            <svg
              data-slot="icon"
              fill="none"
              stroke-width="1.5"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
              class="size-5"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75"
              ></path>
            </svg>
            Nous contacter</a
          >
        </li>
        <li>
          <button
            data-cal-link="anthony-hexium/etude-de-projet"
            data-cal-namespace="etude-de-projet"
            data-cal-config='{"layout":"month_view"}'
            class="group before:transtion-opacity relative isolate hidden w-full cursor-pointer items-center justify-center rounded-md bg-gray-900 px-3 py-1 text-left text-sm font-medium text-white shadow-[0_1px_theme(colors.white/0.07)_inset,0_1px_3px_theme(colors.gray.900/0.2)] ring-1 ring-gray-900 transition duration-300 ease-[cubic-bezier(0.4,0.36,0,1)] before:pointer-events-none before:absolute before:inset-0 before:-z-10 before:rounded-md before:bg-gradient-to-b before:from-white/20 before:opacity-50 before:duration-300 before:ease-[cubic-bezier(0.4,0.36,0,1)] after:pointer-events-none after:absolute after:inset-0 after:-z-10 after:rounded-md after:bg-gradient-to-b after:from-white/10 after:from-[46%] after:to-[54%] after:mix-blend-overlay hover:before:opacity-100 lg:inline-flex"
          >
            Planifier un appel
          </button>
        </li>
      </ul>
    </div>
  </div>

  <button
    id="help-button"
    type="button"
    class="group before:transtion-opacity relative isolate inline-flex h-14 w-14 cursor-pointer items-center justify-center overflow-hidden rounded-full bg-blue-600 px-3 py-1 text-left text-sm font-medium text-white shadow-[0_1px_theme(colors.white/0.07)_inset,0_1px_3px_theme(colors.gray.900/0.2)] ring-[0.375rem] ring-gray-900/6 transition duration-300 ease-[cubic-bezier(0.4,0.36,0,1)] before:pointer-events-none before:absolute before:inset-0 before:-z-10 before:rounded-full before:bg-gradient-to-b before:from-white/20 before:opacity-50 before:duration-300 before:ease-[cubic-bezier(0.4,0.36,0,1)] after:pointer-events-none after:absolute after:inset-0 after:-z-10 after:rounded-full after:bg-gradient-to-b after:from-white/10 after:from-[46%] after:to-[54%] after:mix-blend-overlay hover:before:opacity-100"
    aria-label="Besoin d'aide ?"
    aria-describedby="help-popover"
  >
    <svg
      width="297"
      height="353"
      viewBox="0 0 297 353"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      class="h-6 w-6"
    >
      <path
        d="M0 106.972C0 96.4432 5.51957 86.6849 14.5434 81.2603L133.987 9.45685C143.643 3.65241 155.736 3.74685 165.3 9.70141L178.822 18.1204V124.147L119.115 160.238V90.003L60.0074 124.147V300.11L14.5378 272.763C5.51716 267.337 0 257.581 0 247.054L0 106.972Z"
        fill="white"></path>
      <path
        d="M297 246.007C297 256.536 291.48 266.294 282.457 271.719L162.947 343.562C153.326 349.345 141.281 349.274 131.729 343.376L118.178 335.008L118.178 228.832L177.885 192.741L177.885 262.976L236.993 228.832L236.993 52.8691L282.462 80.2165C291.483 85.6419 297 95.3983 297 105.925L297 246.007Z"
        fill="white"></path>
    </svg>
  </button>
</div>

<script>
  function initHelpButton() {
    const helpButton = document.getElementById('help-button');
    const helpPopover = document.getElementById('help-popover');

    if (!helpButton || !helpPopover) return;

    let isOpen = false;
    let autoTriggered = false;

    function checkAutoTrigger() {
      const body = document.body;
      const autoTriggerValue = body.getAttribute('data-help-button-autotrigger');

      if (!autoTriggerValue || autoTriggerValue === 'disabled') {
        return;
      }

      const today = new Date().toDateString();
      const lastShown = localStorage.getItem('help-popover-last-shown');

      if (lastShown === today) {
        return;
      }

      const delay = parseInt(autoTriggerValue, 10);
      if (isNaN(delay) || delay < 0) {
        return;
      }

      setTimeout(() => {
        if (!isOpen && !autoTriggered) {
          autoTriggered = true;
          showPopover();
        }
      }, delay);
    }

    function showPopover() {
      if (helpPopover) {
        helpPopover.classList.remove('hidden');
        helpPopover.setAttribute('aria-hidden', 'false');

        helpPopover.offsetHeight;

        helpPopover.classList.remove('opacity-0');
        helpPopover.classList.add('opacity-100');
        isOpen = true;

        setTimeout(() => {
          document.addEventListener('click', handleClickOutside);
        }, 100);
      }
    }

    function hidePopover() {
      if (helpPopover) {
        helpPopover.classList.remove('opacity-100');
        helpPopover.classList.add('opacity-0');

        setTimeout(() => {
          helpPopover.classList.add('hidden');
          helpPopover.setAttribute('aria-hidden', 'true');
        }, 200);

        isOpen = false;
        document.removeEventListener('click', handleClickOutside);

        if (autoTriggered) {
          const today = new Date().toDateString();
          localStorage.setItem('help-popover-last-shown', today);
        }
      }
    }

    function handleClickOutside(event: Event) {
      const target = event.target as Node;
      const headerElement = document.querySelector('header');
      const clickedElement = target as Element;

      const isLinkClick = clickedElement.closest && clickedElement.closest('a');

      if (
        helpButton &&
        helpPopover &&
        !helpButton.contains(target) &&
        !helpPopover.contains(target) &&
        !(headerElement && headerElement.contains(target)) &&
        !isLinkClick
      ) {
        hidePopover();
      }
    }

    function togglePopover() {
      if (isOpen) {
        hidePopover();
      } else {
        showPopover();
      }
    }

    helpButton.addEventListener('click', togglePopover);

    document.addEventListener('keydown', (event: KeyboardEvent) => {
      if (event.key === 'Escape' && isOpen) {
        hidePopover();
      }
    });

    checkAutoTrigger();
  }

  document.addEventListener('astro:page-load', initHelpButton);
</script>
